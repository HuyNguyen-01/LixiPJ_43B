<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lì Xì 4K Gold - Responsive Background</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* ===== 1. CẤU TRÚC CHUNG (Dùng cho cả 2 style) ===== */
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            /* Sử dụng dvh (Dynamic Viewport Height) để lấp đầy cả khi thanh điều hướng hiện/ẩn */
            height: 100vh;
            height: 100dvh;
            overflow: hidden;
            background-color: #000;
            font-family: 'Segoe UI', sans-serif;
        }

        .main-container {
            position: relative;
            width: 100%;
            height: 100%;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Các thành phần bên trong có style chung */
        #roller-container {
            position: absolute;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            overflow: hidden;
        }

        .digit-column .digit,
        .separator {
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 900;
            color: #f3d291;
            font-family: 'Arial Black', sans-serif;
            flex-shrink: 0;
        }

        .btn-nhan {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            aspect-ratio: 1/1;
            background-image: url('/But.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            background-color: transparent;
            border: none;
            cursor: pointer;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 10;
        }

        .music-btn {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid #f2d38c;
            background: transparent;
            color: #f2d38c;
            cursor: pointer;
            z-index: 20;
            font-size: 30px;
        }

        /* ===== 2. STYLE CHO MÀN HÌNH NGANG (LAPTOP, TV) ===== */
        @media (orientation: landscape) {
            .main-container {
                background-image: url('/Back.png');
                background-size: cover;
                /* Laptop nên dùng cover để giữ tỷ lệ đẹp */
            }

            #roller-container {
                top: 40%;
                height: 15vw;
            }

            .digit-column .digit,
            .separator {
                height: 15vw;
                font-size: 12vw;
            }

            .btn-nhan {
                bottom: 10%;
                width: 15vw;
            }
            
            .music-btn {
                top: 5%;
                right: 5%;
            }
        }

        /* ===== 3. STYLE CHO MÀN HÌNH DỌC (PHONE, TABLET) ===== */
        @media (orientation: portrait) {
            .main-container {
                background-image: url('/Back_H.png');
                /* CƯỠNG ÉP PHỦ KÍN: Chấp nhận hình ảnh bị méo/giãn để lấp đầy toàn bộ màn hình */
                background-size: 100% 100%;
            }

            #roller-container {
                top: 40%;
                height: 20vw;
            }

            .digit-column .digit,
            .separator {
                height: 20vw;
                font-size: 16vw;
            }

            .btn-nhan {
                bottom: 15%;
                width: 40vw;
            }

            .music-btn {
                top: 1%;
                right: 6%;
            }
        }

        /* ===== 4. HIỆU ỨNG VÀ TRẠNG THÁI ===== */
        .gold-active .digit,
        .gold-active .separator {
            background: linear-gradient(-45deg, #462523, #cb9b51, #f6e27a, #f6f2c0, #f6e27a, #cb9b51, #462523);
            background-size: 400% 400%;
            color: transparent !important;
            -webkit-background-clip: text;
            background-clip: text;
            animation: goldRoll 4s ease-in-out infinite;
        }

        @keyframes goldRoll {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .music-btn.playing {
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to   { transform: rotate(360deg); }
        }

        
    </style>
</head>

<body>

    <div class="main-container">
        <!-- Roller -->
        <div id="roller-container">
            <div class="digit-column" id="col-1"></div>
            <div class="digit-column" id="col-2"></div>
            <div class="digit-column" id="col-3"></div>
            <div class="separator">.</div>
            <div class="digit-column" id="col-4"></div>
            <div class="digit-column" id="col-5"></div>
            <div class="digit-column" id="col-6"></div>
        </div>

        <!-- Nút roll -->
        <button class="btn-nhan" id="rollBtn" onclick="handleClick()"></button>

        <!-- Nút nhạc -->
        <button class="music-btn" id="musicBtn">♪</button>
    </div>

    <script>
        // ===== AUDIO =====
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const bgMusic = new Audio("https://raw.githubusercontent.com/HuyNguyen-01/LixiPJ_43B/main/resouce/1.mp3");
        bgMusic.loop = true;

        // ===== TICK SOUND =====
        function playTickSound() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'square';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(40, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.08, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        // ===== WIN SOUND =====
        function playWinSound() {
            const notes = [523.25, 659.25, 783.99, 1046.50];
            notes.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime + i * 0.15);
                gain.gain.setValueAtTime(0.2, audioCtx.currentTime + i * 0.15);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + i * 0.15 + 0.5);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(audioCtx.currentTime + i * 0.15);
                osc.stop(audioCtx.currentTime + i * 0.15 + 0.5);
            });
        }

        // ===== ROLLER =====
        const denominations = ["010.000", "020.000", "050.000", "100.000", "200.000", "500.000"];
        const columns = [
            document.getElementById('col-1'), document.getElementById('col-2'), document.getElementById('col-3'),
            document.getElementById('col-4'), document.getElementById('col-5'), document.getElementById('col-6')
        ];
        const rollerContainer = document.getElementById('roller-container');
        const btn = document.getElementById('rollBtn');
        let isRollingState = false;

        function initColumns() {
            columns.forEach(col => {
                col.innerHTML = '';
                for (let i = 0; i < 40; i++) {
                    const div = document.createElement('div');
                    div.className = 'digit';
                    div.innerText = Math.floor(Math.random() * 10);
                    col.appendChild(div);
                }
            });
        }
        initColumns();

        function handleClick() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            if (isRollingState) return;
            startRolling();
        }

        function startRolling() {
            isRollingState = true;
            btn.classList.add('is-rolling');
            rollerContainer.classList.remove('gold-active');
            const resultStr = denominations[Math.floor(Math.random() * denominations.length)].replace('.', '');
            const targetDigits = resultStr.split('');
            let tickInterval = setInterval(playTickSound, 100);
            columns.forEach((col, index) => {
                col.style.transition = 'none';
                col.style.transform = 'translateY(0)';
                col.offsetHeight;
                const lastDigit = col.lastElementChild;
                lastDigit.innerText = targetDigits[index];
                const moveY = (col.children.length - 1) * 20;
                col.style.transition = `transform ${2.5 + index * 0.3}s cubic-bezier(0.15,0,0.15,1)`;
                col.style.transform = `translateY(-${moveY}vmin)`;
            });
            setTimeout(() => clearInterval(tickInterval), 2500);
            setTimeout(() => finishRoll(), 4000);
        }

        function finishRoll() {
            playWinSound();
            rollerContainer.classList.add('gold-active');
            fireworks();
            setTimeout(() => { isRollingState = false; btn.classList.remove('is-rolling'); }, 4000);
        }

        function fireworks() {
            const duration = 3 * 1000;
            const end = Date.now() + duration;
            const colors = ['#FFD700', '#FFFFFF', '#FFA500'];
            (function frame() {
                confetti({ particleCount: 3, angle: 60, spread: 55, origin: { x: 0, y: 0.8 }, colors: colors });
                confetti({ particleCount: 3, angle: 120, spread: 55, origin: { x: 1, y: 0.8 }, colors: colors });
                if (Math.random() > 0.9) {
                    confetti({ particleCount: 50, startVelocity: 30, spread: 360, origin: { x: Math.random(), y: Math.random() * 0.5 }, colors: colors });
                }
                if (Date.now() < end) requestAnimationFrame(frame);
            }());
        }

        // ===== MUSIC BUTTON =====
        const musicBtn = document.getElementById("musicBtn");
        let isMusicPlaying = false;
        musicBtn.addEventListener("click", () => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            if (!isMusicPlaying) {
                bgMusic.play();
                musicBtn.classList.add("playing");
            } else {
                bgMusic.pause();
                bgMusic.currentTime = 0;
                musicBtn.classList.remove("playing");
            }
            isMusicPlaying = !isMusicPlaying;
        });
    </script>

</body>

</html>